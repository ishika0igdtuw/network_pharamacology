# âœ… KEGG Pathway Visualization - Setup Complete!

## ğŸ¯ What Changed

### Before:
- `run_analysis.R` generated **top 5** pathways using basic pathview
- Files: `hsa00910.png`, `hsa04915.png`, etc. (without hub highlighting)
- No pathway names in filenames
- No hub gene emphasis

### Now:
- `run_analysis.R` generates **top 10** pathways with **hub gene highlighting**
- Files have **readable names**: `hsa03050_Proteasome_hub_highlighted.png`
- **Clear titles** on each image showing pathway ID, name, and hub statistics
- **Summary visualizations** showing hub distribution across pathways

## ğŸš€ How to Run

### Complete Pipeline (Recommended):
```bash
Rscript run_analysis.R
```

This will:
1. Run all network pharmacology analysis
2. Generate enrichment results
3. **Automatically create top 10 KEGG pathway visualizations** with hub highlighting
4. Add titles and rename files
5. Create summary plots

### Stand-alone KEGG Visualization Only:
```bash
Rscript generate_kegg_visualizations.R
```

### Clean Up Old Files:
```bash
./cleanup_old_kegg_files.sh
```

This removes old pathview files (`hsa*.png`, `hsa*.xml`) from the outputs folder to avoid confusion.

## ğŸ“‚ Output Structure

```
outputs/
â”œâ”€â”€ kegg_pathway_enrichment.csv                    â† Generated by run_analysis.R
â”œâ”€â”€ hub_genes_automated.csv                        â† Generated by hub identification
â”‚
â””â”€â”€ kegg_pathway_visualizations/                   â† All pathway visualizations
    â”œâ”€â”€ OUTPUT_SUMMARY.md
    â”œâ”€â”€ README.md
    â”œâ”€â”€ pathway_visualization_summary.csv
    â”‚
    â”œâ”€â”€ Top 10 Pathways (with titles & readable names):
    â”‚   â”œâ”€â”€ hsa03050_Proteasome_hub_highlighted.png
    â”‚   â”œâ”€â”€ hsa04024_cAMP_signaling_pathway_hub_highlighted.png
    â”‚   â”œâ”€â”€ hsa04080_Neuroactive_ligand_receptor_interaction_hub_highlighted.png
    â”‚   â”œâ”€â”€ hsa04081_Hormone_signaling_hub_highlighted.png
    â”‚   â”œâ”€â”€ hsa04082_Neuroactive_ligand_signaling_hub_highlighted.png
    â”‚   â”œâ”€â”€ hsa04726_Serotonergic_synapse_hub_highlighted.png
    â”‚   â”œâ”€â”€ hsa04728_Dopaminergic_synapse_hub_highlighted.png
    â”‚   â”œâ”€â”€ hsa05017_Spinocerebellar_ataxia_hub_highlighted.png
    â”‚   â””â”€â”€ hsa05417_Lipid_and_atherosclerosis_hub_highlighted.png
    â”‚
    â””â”€â”€ Summary Visualizations:
        â”œâ”€â”€ hub_gene_distribution_summary.png
        â”œâ”€â”€ enrichment_vs_hub_content.png
        â””â”€â”€ pathway_hub_summary_table.png
```

## ğŸ”‘ Key Features

âœ… **Top 10 pathways** (by adjusted p-value)  
âœ… **Hub genes highlighted** in red/orange  
âœ… **Non-hub genes** shown in grey  
âœ… **Pathway ID + Name** clearly displayed as title  
âœ… **Hub statistics** (count and percentage) shown  
âœ… **Readable filenames** with pathway names  
âœ… **Multiple summary plots** for overview  
âœ… **High resolution** (600 DPI)  
âœ… **Publication ready**  

## ğŸ“Š Current Top 10 Pathways

| Rank | Pathway ID | Pathway Name | Hub % |
|------|-----------|--------------|-------|
| 1 | hsa04080 | Neuroactive ligand-receptor interaction | 7.0% |
| 2 | hsa04082 | Neuroactive ligand signaling | 4.4% |
| 3 | hsa03050 | **Proteasome** | **100%** â­ |
| 4 | hsa04024 | cAMP signaling pathway | 37.8% |
| 5 | hsa00910 | Nitrogen metabolism | 0% (skipped) |
| 6 | hsa04728 | Dopaminergic synapse | 42.3% |
| 7 | hsa04726 | Serotonergic synapse | 20.8% |
| 8 | hsa05017 | Spinocerebellar ataxia | 76.9% |
| 9 | hsa04081 | Hormone signaling | 28.1% |
| 10 | hsa05417 | Lipid and atherosclerosis | 58.1% |

**Note:** Nitrogen metabolism (hsa00910) was skipped because it has 0 hub genes.

## â“ Why Not Estrogen or Breast Cancer?

The pathways you saw before (`hsa04915` - Estrogen signaling, etc.) were from an **older run** with **different selection criteria**. 

Current rankings:
- **Estrogen signaling (hsa04915)**: Rank #57 (p = 4.2e-05)
- **Breast cancer (hsa05224)**: Rank #142 (p = 0.019)

These are **not in the top 10** by statistical significance. The current top 10 are selected by **lowest adjusted p-value**.

## ğŸ”„ Integration with Run Analysis

The new visualization is **now integrated** into `run_analysis.R`:

```r
# In run_analysis.R (lines 223-245):
# ---- KEGG Pathway Visualization with Hub Gene Highlighting ----
cat("Generating KEGG pathway visualizations (Top 10)...\n")
tryCatch({
  # Save enrichment results
  kegg_df <- as.data.frame(kk)
  write.csv(kegg_df, "outputs/kegg_pathway_enrichment.csv", row.names = FALSE)
  
  # Run visualization pipeline
  source("tcmnp_functions/visualize_kegg_pathways_with_hubs.R")
  source("tcmnp_functions/add_titles_to_kegg_plots.R")
  source("tcmnp_functions/rename_kegg_files_with_names.R")
  source("tcmnp_functions/create_pathway_summary_plots.R")
  
  cat("âœ” KEGG pathway visualizations complete\n")
}, error = function(e) {
  message("Visualization failed: ", e$message)
})
```

## ğŸ“š Documentation

- **KEGG_VISUALIZATION_GUIDE.md** - Complete usage guide
- **KEGG_VISUALIZATION_COMPLETE.md** - Feature checklist
- **outputs/kegg_pathway_visualizations/OUTPUT_SUMMARY.md** - File listing
- **outputs/kegg_pathway_visualizations/README.md** - Interpretation guide

## âœ… Complete!

Everything is now integrated and ready to use. When you run `run_analysis.R`, it will automatically:
1. Generate top 10 KEGG pathways with hub highlighting
2. Add titles with pathway ID and name
3. Rename files with readable names
4. Create summary visualizations

No more manual steps needed! ğŸ‰

---

**Last Updated**: 2026-01-28  
**Status**: âœ… Fully Integrated  
**Ready for**: Production use
